{"version":3,"file":"download.js","sources":["../bookmarklet/download.js"],"sourcesContent":["var style = document.createElement(\"style\");\nstyle.innerHTML = `\n  .modal-bookmarklet {\n    display: block;\n    position: fixed;\n    z-index: 1;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    overflow: auto;\n    background-color: rgb(0,0,0);\n    background-color: rgba(0,0,0,0.4);\n  }\n\n  .modal-bookmarklet-content {\n    background-color: #fefefe;\n    margin: 15% auto;\n    padding: 20px;\n    border: 1px solid #888;\n    width: 80%;\n  }\n`;\n\nvar myModalHtml = `\n<div id=\"myModal\" class=\"modal-bookmarklet\">\n\n  <div class=\"modal-bookmarklet-content\">\n    <p>Please enter the email addresses you use to send to Kindle</p>\n     <form id=\"bookmarklet-form\">\n       From email:<br>\n       <input type=\"text\" name=\"fromEmail\"><br>\n       Kindle email:<br>\n       <input type=\"text\" name=\"toEmail\">\n       <input type=\"submit\" value=\"Submit\">\n     </form>\n  </div>\n\n</div>\n`;\n\nvar DESKTOP_TITLE_XPATH = '//*[@id=\"bookTitle\"]';\nvar DESKTOP_AUTHOR_XPATH = '//*[@id=\"bookAuthors\"]/span[2]/div/a/span';\nvar MOBILE_TITLE_XPATH = '//div[@class=\"bookInfoGroup\"]/h1/span';\nvar MOBILE_AUTHOR_XPATH = '//a[@class=\"authorName\"]/span';\n\nvar getBookTitle = function() {\n  var desktopTitle = document\n    .evaluate(\n      DESKTOP_TITLE_XPATH,\n      document,\n      null,\n      XPathResult.STRING_TYPE,\n      null\n    )\n    .stringValue.trim();\n\n  var mobileTitle = document\n    .evaluate(MOBILE_TITLE_XPATH, document, null, XPathResult.STRING_TYPE, null)\n    .stringValue.trim();\n\n  if (desktopTitle == \"\") {\n    return mobileTitle;\n  } else {\n    return desktopTitle;\n  }\n};\n\nvar getBookAuthor = function() {\n  var desktopAuthor = document\n    .evaluate(\n      DESKTOP_AUTHOR_XPATH,\n      document,\n      null,\n      XPathResult.STRING_TYPE,\n      null\n    )\n    .stringValue.trim();\n\n  var mobileAuthor = document\n    .evaluate(\n      MOBILE_AUTHOR_XPATH,\n      document,\n      null,\n      XPathResult.STRING_TYPE,\n      null\n    )\n    .stringValue.trim();\n\n  if (desktopAuthor == \"\") {\n    return mobileAuthor;\n  } else {\n    return desktopAuthor;\n  }\n};\n\nvar sendBook = async function(fromEmail, toEmail) {\n  console.log(\"sending request\");\n\n  const response = await fetch(\n    \"https://82aoiobtl0.execute-api.eu-west-2.amazonaws.com/production?query=\" +\n      encodeURIComponent(query) +\n      \"&from=\" +\n      fromEmail +\n      \"&to=\" +\n      toEmail,\n    { method: \"GET\" }\n  );\n\n  if (!response.ok) {\n    throw new Error(\"Fetch error:\", response.statusText);\n  }\n\n  console.log(\"request sent\");\n};\n\nvar title = getBookTitle();\nvar author = getBookAuthor();\nvar query = title + \" \" + author;\n\nvar handleFormSubmit = function(event) {\n  event.preventDefault();\n  var formData = new FormData(event.target);\n  var fromEmail = formData.get(\"fromEmail\");\n  var toEmail = formData.get(\"toEmail\");\n\n  setFromEmail(fromEmail);\n  setToEmail(toEmail);\n\n  sendBook(fromEmail, toEmail, query);\n\n  document.getElementById(\"myModal\").remove();\n};\n\nvar setFromEmail = function(fromEmail) {\n  return window.localStorage.setItem(\"fromEmail\", fromEmail);\n};\n\nvar setToEmail = function(toEmail) {\n  return window.localStorage.setItem(\"toEmail\", toEmail);\n};\n\nvar getFromEmail = function() {\n  return window.localStorage.getItem(\"fromEmail\");\n};\n\nvar getToEmail = function() {\n  return window.localStorage.getItem(\"toEmail\");\n};\n\nvar onBookmarketCall = async function() {\n  var fromEmail = getFromEmail();\n  var toEmail = getToEmail();\n\n  if (fromEmail != undefined && toEmail != undefined) {\n    return await sendBook(fromEmail, toEmail, query);\n  } else {\n    return openModal();\n  }\n};\n\nvar openModal = function() {\n  document.body.insertAdjacentHTML(\"beforeend\", myModalHtml);\n\n  var form = document.getElementById(\"bookmarklet-form\");\n  form.onsubmit = handleFormSubmit;\n\n  var myModal = document.getElementById(\"myModal\");\n\n  window.onclick = function(event) {\n    if (event.target == myModal) {\n      myModal.style.display = \"none\";\n    }\n  };\n};\n\ndocument.head.appendChild(style);\n\nonBookmarketCall();\n"],"names":[],"mappings":"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"}
